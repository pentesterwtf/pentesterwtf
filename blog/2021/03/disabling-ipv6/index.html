<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Stop disabling IPv6 - Pentester, wtf!?</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Stop disabling IPv6"><meta property="og:description" content="'IPv6 is a mandatory part of the Windows operating system'"><meta property="og:type" content="article"><meta property="og:url" content="/blog/2021/03/disabling-ipv6/"><meta property="article:published_time" content="2021-03-11T18:00:00+10:00"><meta property="article:modified_time" content="2021-03-11T18:00:00+10:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Stop disabling IPv6"><meta name=twitter:description content="'IPv6 is a mandatory part of the Windows operating system'"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:500,100,300" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css></head><body><div class="container wrapper post"><div class=header><a href=/><img src=/images/header.png alt="Break things, write reports"></a><div class=site-description></div><nav class=nav><ul class=flat><li><a href=/>home</a></li><li><a href=/categories/>Categories</a></li><li><a href=/tags/>Tags</a></li></ul></nav></div><div class=post-header><h1 class=title>Stop disabling IPv6</h1><h3><blockquote>'IPv6 is a mandatory part of the Windows operating system'</blockquote></h3><div class=meta>Tags &mdash; |
<a href=/tags/windows/>windows</a> |
<a href=/tags/ipv6/>ipv6</a> |
<a href=/tags/zero%20trust/>zero trust</a> |
Categories: &mdash;
<a href=/categories/policy-induced-problems/>policy-induced-problems</a> |</div><div class=meta>Posted at &mdash; Mar 11, 2021</div></div><div class=markdown><p>You might have gotten here from reading documents such as the <a href=https://www.cyber.gov.au/acsc/view-all-content/ism>Information Security Manual (ISM)</a>, which states things like the following:</p><p><code>Internet Protocol version 6 (IPv6) functionality can introduce additional security risks to a network. As such, disabling IPv6 functionality until it is intended to be used will minimise the attack surface of the network and ensure that any IPv6 functionality that is not intended to be used cannot be exploited.</code></p><p>It then goes to list some of the things one should do, such as disabling ipv6:</p><p><code>Security Control: 0521; Revision: 5; Updated: Sep-18; Applicability: O, P, S, TS IPv6 functionality is disabled in dual-stack network devices and ICT equipment unless it is being used.</code></p><p><code>Security Control: 1429; Revision: 2; Updated: Jan-20; Applicability: O, P, S, TS IPv6 tunnelling is blocked by network security devices at externally-connected network boundaries.</code></p><p>Reading the <a href=https://www.cyber.gov.au/sites/default/files/2019-04/21.%20ISM%20-%20Guidelines%20for%20Network%20Management%20%28APR19%29.pdf>PDF Edition</a>, it labels these as <em>musts</em> - i.e. disable it.</p><p>Someone more familiar with the ISM would argue that the difference between a <code>should</code> and a <code>must</code> is only a different level of approval to <em>not do it</em>, howver that is not the subject of this post.</p><p>There&rsquo;s already been a bunch of writeups on this topic, and what can go wrong, notably:</p><ul><li><a href=https://blog.rmilne.ca/2014/10/29/disabling-ipv6-and-exchange-going-all-the-way/>Disabling IPv6 And Exchange – Going All The Way</a><ul><li><code>Unless there are specific reasons for disabling IPv6 please do not do it.</code>, says the sysadmin who had to diagnose Microsoft Exchange issues</li></ul></li></ul><p>Microsofts <a href="https://docs.microsoft.com/en-us/previous-versions/technet-magazine/dd822905(v=msdn.10)?redirectedfrom=MSDN">official stance</a> on the topic is as follows:</p><p><code>From Microsoft's perspective, IPv6 is a mandatory part of the Windows operating system and it is enabled and included in standard Windows service and application testing during the operating system development process. Because Windows was designed specifically with IPv6 present, Microsoft does not perform any testing to determine the effects of disabling IPv6. If IPv6 is disabled on Windows Vista, Windows Server 2008, or later versions, some components will not function. Moreover, applications that you might not think are using IPv6—such as Remote Assistance, HomeGroup, DirectAccess, and Windows Mail—could be.</code></p><p>Although an outdated reference to DirectAccess and being written in 2016, it&rsquo;s unclear if their policy has changed, or if disabling the setting now means your organisation can no longer <a href=https://partner.microsoft.com/en-us/support/microsoft-services-premier-support>recieve support</a>.</p><p>This has recently been revised in <a href=https://docs.microsoft.com/en-US/troubleshoot/windows-server/networking/configure-ipv6-in-windows>August 2020</a>, stating in this very large, very colourful box:</p><p><img src=/img/ms-stance-ipv6.png alt=Mandatory></p><p>Unfortunately, this is also propogated by penetration testers as a mitigation to someone using <a href=https://github.com/fox-it/mitm6>mitm6</a>, such as the <a href=https://www.fox-it.com/en/news/blog/mitm6-compromising-ipv4-networks-via-ipv6/>authors of the tooling</a>:</p><p><code>The only defense against this attack that we are currently aware of is disabling IPv6 if it is not used on your internal network. This will stop Windows clients querying for a DHCPv6 server and make it impossible to take over the DNS server with the above described method.</code></p><p>Not that they are the only penetration testers recommending disabling ipv6.</p><h2 id=root-cause>Root cause</h2><p>The bigger, unaddressed root causes here are as follows:</p><ul><li>Layer 2 has traditionally been overtrusted</li><li>Window&rsquo;s link-local ideas of discovery were a bad idea (NETBIOS, LLMNR)</li><li>WPAD was a bad idea</li><li>Protocols with bad cryptographic implementations are not good to use (i.e. NTLMv1 being effectively <a href=https://en.wikipedia.org/wiki/NT_LAN_Manager>DES + md4)</a></li><li>Protocols designed without encryption were a bad idea, especially when used for authentication (i.e. LDAP not LDAPs)</li></ul><p>The <a href=https://en.wikipedia.org/wiki/Jericho_Forum>Jericho Forum</a> had published a paper on <a href=https://collaboration.opengroup.org/jericho/Protocols_v1.0.pdf>the need for inherantly secure protocols</a> back in 2006, in an attempt to work around terrible network decisions such as making a perimeter network, instead of just treating everything <a href=https://research.google/pubs/pub43231/>around you as hostile</a>. Between the two, this led to the concept of Zero Trust.</p><h2 id=not-all-pentesters>Not all pentesters</h2><p>Luckily, some pentest firms are identifying that it&rsquo;s a bad idea, and not recommending to disable ipv6:</p><ul><li><a href=https://dirkjanm.io/worst-of-both-worlds-ntlm-relaying-and-kerberos-delegation/>Disabling IPv6 entirely may have unwanted side effects.</a></li></ul><p>Finally, mentioning <a href=https://blog.vonahi.io/taking-over-ipv6-networks/>vohai</a> for pointing out the mitigations are probably better off working around controlling the network better, instead of disabling ipv6.</p></div></div><div class="footer wrapper"><nav class=nav><div></div></nav></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-141761824-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>