<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Kiwicon 2018 notes - Pentester, wtf!?</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Kiwicon 2018 notes"><meta property="og:description" content="Thoughts on Kiwicon 2018"><meta property="og:type" content="article"><meta property="og:url" content="/blog/2018/conference-kiwicon/"><meta property="article:published_time" content="2018-12-01T12:30:47+10:00"><meta property="article:modified_time" content="2018-12-01T12:30:47+10:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Kiwicon 2018 notes"><meta name=twitter:description content="Thoughts on Kiwicon 2018"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:500,100,300" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css></head><body><div class="container wrapper post"><div class=header><a href=/><img src=/images/header.png alt="Break things, write reports"></a><div class=site-description></div><nav class=nav><ul class=flat><li><a href=/>home</a></li><li><a href=/categories/>Categories</a></li><li><a href=/tags/>Tags</a></li></ul></nav></div><div class=post-header><h1 class=title>Kiwicon 2018 notes</h1><h3><blockquote>Thoughts on Kiwicon 2018</blockquote></h3><div class=meta>Tags &mdash; |
<a href=/tags/Kiwicon/>Kiwicon</a> |
Categories: &mdash;
<a href=/categories/notes/>notes</a> |
<a href=/categories/conference/>conference</a> |</div><div class=meta>Posted at &mdash; Dec 1, 2018</div></div><div class=markdown><h1 id=matt-garret-shitty-scooters>Matt Garret, Shitty Scooters</h1><ul><li>Meta<ul><li>Moved to replace Jess Frazelle</li><li>First X minutes explaining the economy of scooters</li><li>Notably, some look like they&rsquo;re in Australia too</li><li>Moved into reversing the android app</li><li>Guy grepped for <code>https://</code> in the app</li><li>Bunch of privacy violations</li></ul></li><li>Reversing a scoooter app (For Lime)</li><li>Commercial scooter<ul><li>Terrible one - GPS tracker / gear</li><li>Better ones have modems/controls</li></ul></li><li>First gen Lime scooters were getting people injured, allegedly</li><li>What the app is<ul><li>Shows you where the scooters are (With Identifiers, has a number on the scooter)</li><li>Lets you hire a scooter</li><li>When hired, scooter doesnt show on UI, but will tell you where it ends up when its finished</li></ul></li><li>What the API lets you do<ul><li>Request the location of every scooter (6 digit ID, not a large keyspace)</li><li>Also lets you request where an <em>in use</em> scooter is, while hired</li></ul></li><li>Guy plots location of where the scooters are<ul><li>They&rsquo;re broadacasting when they&rsquo;re manfactured and moved from factory to factory</li><li>Theres about 250k of them</li></ul></li><li>Theres other shitty scooter places, go figure<ul><li>Vendor called &lsquo;spin&rsquo;, sold to Ford</li><li>Not really on the internet, just bluetooth to phones and forwards data via that</li><li>Could have used TOTP, or anything shitty</li><li>you send a series of bytes to them and they unlock</li><li>The scooter can&rsquo;t call home without the app, its got no hardware to do so</li></ul></li></ul><h2 id=moloch--mandatory-cloudbigdata-to-pentest-at-scale>Moloch & Mandatory, Cloud/BigData to pentest at scale</h2><ul><li><p>Meta</p><ul><li>&ldquo;The slowest part of Amazon is the support&rdquo;</li><li>github search &lsquo;mandatoryprogrammer&rsquo; &lsquo;intruder&rsquo;</li><li>github search &lsquo;mandatoryprogrammer&rsquo; &lsquo;masscat&rsquo;</li><li>github search &lsquo;moloch&ndash;&rsquo; &lsquo;big rainbow&rsquo;</li></ul></li><li><p>People</p><ul><li>Mandatory - @iammandatory (Matthew Brian)<ul><li>Writer of XSSHunter</li></ul></li><li>Moloch - @littlejoetables<ul><li>BishopFox guy</li></ul></li></ul></li><li><p>Burp intruder at PS</p></li><li><p>Cloud rainbow tables</p></li><li><p>Cost effective GPU clusters</p></li><li><p>&ldquo;Burp Intruder&rdquo; at infinate QPS</p><ul><li>(Burp proxy + replacement tags)</li><li>Limitations - Threaded model, single app, single computer</li><li>Use lambdas</li><li>Self invocating lambda with a big array of work</li><li>Their model just does a fan out</li><li>1k/s lambda second execution</li></ul></li><li><p>Rainbow Tables</p><ul><li>Stick it into google big query</li><li>generate the rainbow table, stick it into json blobs, put it into big query</li><li>optimisations - base64 it or better encoding</li><li>optimisations - truncate hash at 48bits (Collisions are not a huge concern)</li></ul></li><li><p>Auto-scaling GPU clusters</p><ul><li>high upfront costs, etc</li><li>Spot instances, elasticbeanstalk, lambda functions, api gateway, sqs, s3</li><li>They give you a 2 minute warning before killing it</li><li>beanstalk gives you EC2 instances and routes messages on queue</li><li>&ldquo;SpotPrice&rdquo;</li></ul></li></ul><h2 id=slacksdl>Slack/SDL</h2><ul><li>Tl;dr<ul><li>Slack read <code>the checklist manifesto</code> and believe that<ul><li>Doctors who do checklists kill people 50% less</li><li>Airlines that do pre-flight checklists have less crashes</li></ul></li><li>When you make a new thing, you hit a slack bot and it&rsquo;ll create some tickets</li><li>The tickets ask you some questions, then give you checklists based on that output</li><li>The checklists seem to be mostly self-service and documentation</li><li>They automated out the checklist people and just log the results in Jira</li></ul></li></ul><h2 id=bruce-schniener>Bruce Schniener</h2><ul><li>Computers<ul><li>&ldquo;This is not a phone, this is a computer that makes calls&rdquo;</li><li>&ldquo;A car is a computer with 4 wheels and an engine&rdquo; or &ldquo;actually it&rsquo;s 100 computers+ with wheels&rdquo;</li><li>This is true at all scales (fridge to nuclear power plant)</li></ul></li><li>The Internet<ul><li>Made on the assumption of security being addressed on the endpoint, rather than the internet itself</li></ul></li><li>Extensibility<ul><li>Property we know, but the rest of the world doesnt know</li><li>We cant constrain the functionality of a computer-ised device</li><li>This is why Fridges can sent spam</li><li>Installing malware on a device is just adding functionality/features</li></ul></li><li>Complexity<ul><li>Attack is easier than Defence</li><li>Attackers can choose the attack, and its conditions</li><li>&ldquo;Complexity is the worst enemy of security&rdquo;</li></ul></li><li>Interconnections<ul><li>We have vulnerabilities in connected systems</li><li>Bugs in component A can effect component B</li><li>Vegas, high roller DB got stoled via internet connected fishtank</li><li>&ldquo;You can have an insecurity in the intersect of two secure systems&rdquo;</li></ul></li><li>Expertise<ul><li>Goes downhill</li><li>NSA -> PhD thesis -> HackerTools</li><li>e.g. Stingray devices</li></ul></li><li>Changes<ul><li>Computers are being used differently</li><li>Automation and Physical Agency</li><li>Theres real risk to life</li><li>Availability attacks against systems with physical agency is scary<ul><li>i.e. turn off car steering systems (availability), and now you hit a tree/die</li></ul></li><li>&ldquo;Theres a fundamental difference between your office product crashing and you losing your software, and your pacemaker crashing and you lose your life&rdquo;<ul><li>&ldquo;this could be the same CPU even&rdquo;</li></ul></li></ul></li><li>Failures<ul><li>Patching<ul><li>Phones are secure-ish because of initial engineering</li><li>and because those engineers also write and propogate patches ASAP</li><li>(This costs a pile of money, but on low cost devices this doesnt happen, ie, fishtanks)</li><li>How you patch a router, is by throwing it in the bin<ul><li>This is a pretty good system, new devices are sometimes more secure</li></ul></li><li>&ldquo;we dont know how to write secure software, so we are agile about patching&rdquo;</li><li>&ldquo;There is a reason microsoft bin their older stuff, its hard to keep secure&rdquo;</li><li>We cant do that for our cars, they depreciate at different rates</li><li>We don&rsquo;t know how to do patches at scale for these fringe devices</li></ul></li><li>Authentication<ul><li>We know how to do person-to-thing/service auth</li><li>We dodn&rsquo;t know how to do thing-to-thing authentication<ul><li>i.e. Car auth to emergency broadcast system</li></ul></li><li>We know how to do person-to-thing/service auth</li><li>We can do bluetooth comms from phones to cars, but we do that <em>manually</em></li><li>Manually doing shit is really hard</li><li>Smartphones have become the smarthome controller / auth set-up thingy</li><li>again, this is manual and won&rsquo;t scale past a handful of devices</li></ul></li><li>Supply Chain problem<ul><li>&ldquo;Where are the chips made&rdquo;</li><li>We find backdoors in F5s and Dlink all the time</li><li>2003 - Barely avoided a shitty backdoor in linux</li><li>Cisco gear being modified by NSA dudes on the way to foreign Telcos</li></ul></li></ul></li><li>Choices<ul><li>&ldquo;security vs security&rdquo; tradeoff<ul><li>We secure all stuff, or we secure none of this</li><li>We all get to spy, or none of us do</li></ul></li></ul></li><li>Promising stuff<ul><li>give the router some smarts<ul><li>Manufacturer usage descriptions</li><li>you buy a fridge, it connects to the internet, the router gets a signed list of things the fridge can do</li><li>if the fridge starts doing weird stuff, it blocks it</li><li>Meta - this is either Senrio or a shitty IPS, it&rsquo;ll probably suck</li></ul></li></ul></li><li>Problem is &ldquo;lack of tech adoption ideas&rdquo;<ul><li>Equifax happened, you weather the press storm and it&rsquo;ll be fine</li></ul></li><li>Regulation is the only way<ul><li>Nothing got better without it</li><li>The market doesnt reward security</li><li>The market rewards least viable security in a product</li><li>&ldquo;If we want better we need to force the market to do better&rdquo;</li></ul></li><li>What we (the room) can do<ul><li>&ldquo;we technologists need to be involved in policy&rdquo;</li><li>&ldquo;We need to build a career path for public technology security to policy people&rdquo;</li></ul></li></ul><h2 id=dhcp-is-hard>DHCP is hard</h2><ul><li>Meta<ul><li>Missed the first 15 minutes</li><li>Looks like they&rsquo;re finding memory corruption in DHCP clients</li><li>Moved into looking at CVE-2018-5733 / ISC DHCP Client<ul><li>Reckons its Reliable RCE</li></ul></li><li>Lots of different clients, some rely on bash scripts/hooks</li></ul></li><li>NetworkManager helpers vs dhclient<ul><li>Fedora dudes made <code>dispatcher.d</code> hooks, which translates hooks for you</li><li>This thing is a big eval block (dynoroot)</li><li>Triggering - WPAD Option 252 `foo' & touch /tmp/test123'</li><li>Works on every Redhat/centos system for the last 5 years</li></ul></li><li>Systemd / networkd<ul><li>used on RHEL/Ubuntu</li><li>no dependancies on external DHCP clients</li><li>Modern C / Clean rewrite/no historical baggage</li><li>Bugs in IPv6 side, even if not enabled (CVE-2018-15688)</li></ul></li><li>Conclusion<ul><li>DHCP is hard</li><li>no one uses ipv6 but everything supports it</li><li>backwards compatability increases attack surface</li><li>please dont write new network daemons in C</li></ul></li></ul><h2 id=backdooring-with-service-workers>&ldquo;Backdooring with Service Workers&rdquo;</h2><ul><li>Meta<ul><li>Emmanuel Law</li><li>Claudio Contin</li></ul></li><li>Mitigations are making things hard&mldr;ish<ul><li>HTTP-Only Flags</li><li>Cookies have limited server-side lifespan</li><li>Transient Payload</li><li>IP restrictions</li><li>Service workers can help address these</li></ul></li><li>Service Workers (SW)<ul><li>JS browser runs in the background</li><li><em>Are not tied to the tab, and will keep running after you close it</em></li><li>No user magic needed to get it to work</li><li>e.g. Gmail, composing email - You lose internet access<ul><li>Web app still runs as if it was connected to the internet</li><li>Service worker ends up syncing things for you automatically</li></ul></li></ul></li><li>Spinning one up<ul><li>We need XSS, and to point to a JS File (On same origin)</li><li>`navigator.serviceWorker.register('/sw.js')</li></ul></li><li>Primatives provided<ul><li>Fetch()<ul><li>Web requests, no XMLHTTPRequest (Deprecated in 2015)</li><li>Bounded to Same Origin Policy</li></ul></li><li>Background Sync<ul><li>Intended for offline capabilities</li><li>2 step process, Register a Sync and Listen for Sync event</li><li>Problems - You cant control callback interval, or for how long</li><li>You spin up multiple ones with offset startups, so now you have better coverage</li><li>Get these to register new ones before they close for persistence</li></ul></li><li>Push notifications<ul><li>Notification API</li></ul></li></ul></li><li>End Result<ul><li>Guy uses Service Workers to re-implement BeeF pivot via victim browsers</li></ul></li><li>Mitigations<ul><li>CSP / NOXSS</li><li>Disallow JS Upload</li><li>Text/plain</li><li>TODO - Others?</li></ul></li><li>SW outlives XSS<ul><li>Fixing XSS isnt enough</li><li>Removing the service worker file alone isnt enough</li><li>You need to unregister them from server side</li></ul></li><li>Summary<ul><li>SW - Provides Persistent Access</li><li>Still being designed and implemented</li></ul></li><li>None of this works in IE, as it doesn&rsquo;t support them<ul><li>Edge kind of supports it, barely</li></ul></li></ul><h2 id=mubix---living-without-the-land>Mubix - &ldquo;Living without the land&rdquo;</h2><ul><li>Tl;dr<ul><li>Tl;dr - Pull stuff out of LDAP and use it to your advantage</li><li>Released a tool, <code>LDAP-WAT</code> - LDAP windows attack toolkit</li><li>You can add a host as a DC, then dcsync that</li><li>Did this tool ever come out? I don&rsquo;t see it</li></ul></li><li>Meta<ul><li>Check out ADRecon made by some other guy that Mubix was going to use</li><li>Written in PowerShell</li><li>Lots of Bill Murray things that I don&rsquo;t care about</li><li>LDAPSearch sucks, presumably this guy wrote a new tool or something</li></ul></li><li>No Slides</li><li>PowerShell now has a pile of logging<ul><li>&ldquo;It was cool when it was version 2 and had no logging&rdquo;</li><li>Microsoft had the big play of getting offense to use and rely on PowerShell</li><li>What about when you use a linux box that isn&rsquo;t a domain joined machine</li></ul></li><li>ldapsearch is rubbish, the doco is rubbish and everything about it is rubbish</li><li>&ldquo;Add new DC with Domain Join Accoint&rdquo;<ul><li>You can join a machine and sepcify the properties of the box <em>as it joins</em></li><li>This includes adding a box as a Domain Controller</li><li>Caveat - Too many attributes gives you an access denied, but the <code>DC</code> flag alone will work</li></ul></li></ul></div></div><div class="footer wrapper"><nav class=nav><div></div></nav></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-141761824-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>