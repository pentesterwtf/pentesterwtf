<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Generating fast hashes, part 2 - Pentester, wtf!?</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Generating fast hashes, part 2"><meta property="og:description" content="Still using SHA for hashes senselessly? Consider not using cryptographic hashes for everything in your life"><meta property="og:type" content="article"><meta property="og:url" content="/blog/2021-02-09-sunspot-hashes/"><meta property="article:published_time" content="2021-02-09T18:30:00+10:00"><meta property="article:modified_time" content="2021-02-09T18:30:00+10:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Generating fast hashes, part 2"><meta name=twitter:description content="Still using SHA for hashes senselessly? Consider not using cryptographic hashes for everything in your life"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:500,100,300" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css></head><body><div class="container wrapper post"><div class=header><a href=/><img src=/images/header.png alt="Break things, write reports"></a><div class=site-description></div><nav class=nav><ul class=flat></ul></nav></div><div class=post-header><h1 class=title>Generating fast hashes, part 2</h1><div class=meta>Posted at &mdash; Feb 9, 2021</div></div><div class=markdown><p>I previously shilled xxHash (<a href=https://pentester.wtf/blog/2020-10-13-xxhash/),>https://pentester.wtf/blog/2020-10-13-xxhash/),</a> but I&rsquo;m pretty happy when I see malware using fast hashes for non security related tasks, rather than just using SHA/Bcrypt/whatever and being terribly slow. With that in mind, I&rsquo;d like to reiterate:</p><p>If you&rsquo;re writing <del>code</del> malware, and need to generate deterministic identifiers for data - such as if you&rsquo;re <del>scraping a website</del> comparing processes on an endpoint to ones you care about (i.e. msbuild), and your code looks like this:</p><pre><code>&gt;&gt;&gt; import hashlib
&gt;&gt;&gt; import psutil
&gt;&gt;&gt; # SUPER SECRET PROCESS WE DON'T WANT PEOPLE TO KNOW WE'RE LOOKING FOR
&gt;&gt;&gt; NOT-SECRET-OBVIOUS-HASH = d4c5d22baf120b953ceb85a4d142f1c5fef2b002b2f1a050345ec1e90c5aeaa8
&gt;&gt;&gt; # Dump processes, iterate over them one by one
&gt;&gt;&gt; for p in psutil.process_iter():
&gt;&gt;&gt;    m = hashlib.sha256()
&gt;&gt;&gt;    m.update(str.encode(p.name()))
&gt;&gt;&gt;    if m.hexdigest() == NOT-SECRET-OBVIOUS-HASH:
&gt;&gt;&gt;        # Inject into memory, be naughty, etc

</code></pre><p>Then you&rsquo;re burning CPU cycles a lot, for properties you probably didn&rsquo;t want: i.e. taking forever to defeat someone just bruteforcing a password dump.
<del>Instead, consider using something like xxHash (<a href=https://github.com/Cyan4973/xxHash),>https://github.com/Cyan4973/xxHash),</a> which is going to be significantly quicker, and save a lot of resources.</del></p><p>Instead, consider doing what the authors of SUNSPOT did, and just use ELFhash! <a href=https://www.crowdstrike.com/blog/sunspot-malware-technical-analysis/>https://www.crowdstrike.com/blog/sunspot-malware-technical-analysis/</a></p><p>Obviously tongue in cheek, but it&rsquo;s cool to see the use of non-cryptographic hashes for appropriate applications, instead of just mindlessly applying SHA everywhere.</p><p>Plus, to the inexperienced SOC/Blue teamer, they&rsquo;re not going to reverse that hashing algorithm - it&rsquo;s more likely they&rsquo;re going to be lazy and look for SHA primatives or just imports.</p></div></div><div class="footer wrapper"><nav class=nav><div></div></nav></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-141761824-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>