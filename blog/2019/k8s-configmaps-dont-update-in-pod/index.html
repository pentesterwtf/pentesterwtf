<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>K8s config maps don't update in pods when mounted as volumes - Pentester, wtf!?</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="K8s config maps don't update in pods when mounted as volumes"><meta property="og:description" content="K8s oddities to keep in mind - changes to configmaps don't get reflected in realtime to pods"><meta property="og:type" content="article"><meta property="og:url" content="/blog/2019/k8s-configmaps-dont-update-in-pod/"><meta property="article:published_time" content="2019-08-13T20:30:00+10:00"><meta property="article:modified_time" content="2019-08-13T20:30:00+10:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="K8s config maps don't update in pods when mounted as volumes"><meta name=twitter:description content="K8s oddities to keep in mind - changes to configmaps don't get reflected in realtime to pods"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:500,100,300" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css></head><body><div class="container wrapper post"><div class=header><a href=/><img src=/images/header.png alt="Break things, write reports"></a><div class=site-description></div><nav class=nav><ul class=flat><li><a href=/>home</a></li><li><a href=/categories/>Categories</a></li><li><a href=/tags/>Tags</a></li></ul></nav></div><div class=post-header><h1 class=title>K8s config maps don't update in pods when mounted as volumes</h1><div class=meta>Posted at &mdash; Aug 13, 2019</div></div><div class=markdown><p>Given the following config, would an update to a configmap propogate to a pod?</p><pre><code>apiVersion: v1
kind: ConfigMap
metadata:
  name: special-config
  namespace: default
data:
  data: this-is-an-initial-value
---
apiVersion: v1
kind: Pod
metadata:
  name: pod-demo
spec:
  containers:
  - name: nginx
    image: nginx
    volumeMounts:
      - name: config-volume
        mountPath: /etc/config
  volumes:
    - name: config-volume
      configMap:
        name: special-config
  restartPolicy: Never
</code></pre><p>Initially, it&rsquo;s set to what you&rsquo;d expect:</p><pre><code>$ k apply -f demo-configmap.yml 
configmap/special-config created
pod/pod-demo created
$ k exec -it pod-demo cat /etc/config/data &amp;&amp; echo 
this-is-an-initial-value
</code></pre><p>After modification, it doesn&rsquo;t appear to have propagated</p><pre><code>$ k edit cm special-config 
configmap/special-config edited
$ k get cm special-config -o yaml
apiVersion: v1
data:
  data: this-is-modified
kind: ConfigMap
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {&quot;apiVersion&quot;:&quot;v1&quot;,&quot;data&quot;:{&quot;data&quot;:&quot;this-is-modified&quot;},&quot;kind&quot;:&quot;ConfigMap&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;special-config&quot;,&quot;namespace&quot;:&quot;default&quot;}}
  creationTimestamp: &quot;2019-08-13T01:42:23Z&quot;
  name: special-config
  namespace: default
  resourceVersion: &quot;38232031&quot;
  selfLink: /api/v1/namespaces/default/configmaps/special-config
  uid: bf334aaa-1e86-498c-9e7b-2079e13425c1
$ k exec -it pod-demo cat /etc/config/data &amp;&amp; echo 
this-is-an-initial-value
</code></pre><p>This is especially infuriating that an update to a configmap won&rsquo;t trigger a new deployment, which makes certain deployments a pain.</p><p>This is a well known issue, and is tracked in <a href=https://github.com/kubernetes/kubernetes/issues/22368>https://github.com/kubernetes/kubernetes/issues/22368</a></p></div></div><div class="footer wrapper"><nav class=nav><div></div></nav></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-141761824-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>